<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Cyber Security: Duo Overdrive</title>
    <style>
        body { margin: 0; background: black; color: #0f0; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        #overlay { position: absolute; inset: 0; background: black; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #video-container { position: relative; width: 320px; height: 240px; border: 2px solid #0f0; margin-bottom: 20px; overflow: hidden; display: none; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .scan-line { position: absolute; width: 100%; height: 2px; background: #0f0; top: 0; animation: scan 2s infinite linear; }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }
        #status-text { font-size: 20px; margin-top: 15px; font-weight: bold; }
        canvas { display: none; background: #050505; border: 2px solid #222; cursor: crosshair; }
        #stats { position: fixed; top: 10px; width: 95%; display: none; justify-content: space-between; background: rgba(0,20,0,0.8); padding: 10px; border: 1px solid #0f0; z-index: 40; font-size: 13px; }
        .menu { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); background: black; border: 2px solid #0f0; padding: 30px; z-index: 200; text-align: center; }
        button { background: #030; color: #0f0; border: 1px solid #0f0; padding: 10px 20px; cursor: pointer; font-family: inherit; margin: 5px; }
        .ulti-box { width: 80px; height: 8px; border: 1px solid #0f0; display: inline-block; position: relative; background: #111; }
        .ulti-fill { height: 100%; background: yellow; width: 0%; box-shadow: 0 0 5px yellow; }
    </style>
</head>
<body>

<div id="overlay">
    <div id="video-container"><video id="webcam" autoplay playsinline></video><div class="scan-line"></div></div>
    <div id="status-text">SISTEM ANALIZI...</div>
    <div id="setup-field" style="display:none; text-align: center;">
        <input type="password" id="pw" placeholder="SIFRE" style="padding:10px; background:#000; border:1px solid #0f0; color:#0f0; text-align:center;"><br><br>
        <button onclick="startGame(1)">1 OYUNCU (@)</button>
        <button onclick="startGame(2)">2 OYUNCU (@ & F)</button>
    </div>
</div>

<div id="stats">
    <div>P1 (@): ‚ù§Ô∏è%<span id="h1">100</span> | üí∞$<span id="m1">0</span> | ULT: <div class="ulti-box"><div id="u1" class="ulti-fill"></div></div></div>
    <div id="p2-info" style="display:none; color:yellow;">P2 (F): ‚ù§Ô∏è%<span id="h2">100</span> | üí∞$<span id="m2">0</span> | ULT: <div class="ulti-box"><div id="u2" class="ulti-fill"></div></div></div>
    <div>üåä DALGA: <span id="w">1</span></div>
</div>

<div id="mUI" class="menu">
    <h2 id="mTitle">MARKET</h2>
    <button onclick="buyW('POMPALI', 100)">POMPALI ($100)</button>
    <button onclick="buyW('ALEV MAKINESI', 500)">ALEV MAKINESI ($500)</button>
    <button onclick="buyA()">EKSTRA FIREWALL ($200)</button><br>
    <button onclick="closeM()" style="background:red; color:white;">KAPAT</button>
</div>

<canvas id="c"></canvas>

<script>
    const can = document.getElementById('c'), ctx = can.getContext('2d');
    let run = 0, isDuo = false, paused = false, wave = 1, slowMo = 0, boss = null, shoppingPlayer = null;
    let p1 = { x: 300, y: 300, s: 4, hp: 100, money: 0, inv: ['ASCII'], cur: 0, lastS: 0, ulti: 0, sym: "@", color: "#0f0" };
    let p2 = { x: 500, y: 300, s: 4, hp: 100, money: 0, inv: ['ASCII'], cur: 0, lastS: 0, ulti: 0, sym: "F", color: "yellow" };
    let enemies = [], bullets = [], keys = {}, mPos = { x: 0, y: 0, d: 0 };
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%&*";

    window.onload = async () => {
        try { const s = await navigator.mediaDevices.getUserMedia({ video: true }); document.getElementById('webcam').srcObject = s; document.getElementById('video-container').style.display='block'; } catch(e){}
        setTimeout(() => { document.getElementById('status-text').innerText="MOD SECIN"; document.getElementById('setup-field').style.display='block'; }, 1500);
    };

    function startGame(mode) {
        if(document.getElementById('pw').value !== 'hihiha123') return alert("SIFRE YANLIS");
        isDuo = mode === 2;
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('stats').style.display = 'flex';
        if(isDuo) document.getElementById('p2-info').style.display = 'block';
        can.style.display = 'block'; can.width = 800; can.height = 600;
        run = 1; spawn(); loop();
    }

    window.buyW = (n, p) => { let plr = shoppingPlayer === 1 ? p1 : p2; if(plr.money >= p) { plr.money -= p; plr.inv.push(n); closeM(); } };
    window.buyA = () => { let plr = shoppingPlayer === 1 ? p1 : p2; if(plr.money >= 200) { plr.money -= 200; plr.hp += 50; closeM(); } };
    window.closeM = () => { paused = false; document.getElementById('mUI').style.display = 'none'; };

    window.onkeydown = e => { 
        keys[e.code] = 1; 
        if(e.code === 'KeyM') { shoppingPlayer = 1; paused = true; document.getElementById('mUI').style.display = 'block'; document.getElementById('mTitle').innerText = "P1 MARKET"; }
        if(e.code === 'End' && isDuo) { shoppingPlayer = 2; paused = true; document.getElementById('mUI').style.display = 'block'; document.getElementById('mTitle').innerText = "P2 MARKET"; }
        if(e.code === 'KeyE' && p1.ulti >= 10) triggerUlti(p1);
        if(e.code === 'NumpadMultiply' && isDuo && p2.ulti >= 10) triggerUlti(p2);
        if(e.code === 'Digit1') p1.cur = 0; if(e.code === 'Digit2' && p1.inv[1]) p1.cur = 1;
        if(e.code === 'Delete' && isDuo) p2.cur = (p2.cur + 1) % p2.inv.length;
    };
    window.onkeyup = e => keys[e.code] = 0;
    can.onmousemove = e => { let r = can.getBoundingClientRect(); mPos.x = e.clientX-r.left; mPos.y = e.clientY-r.top; };
    can.onmousedown = () => mPos.d = 1; can.onmouseup = () => mPos.d = 0;

    function triggerUlti(p) {
        p.ulti = 0; slowMo = 180; // 3 saniye slow motion
        for(let i=0; i<60; i++) {
            let a = (Math.PI*2/60)*i;
            bullets.push({ x: p.x, y: p.y, vx: Math.cos(a)*12, vy: Math.sin(a)*12, t: "HASH", l: 100, u: true, c: "cyan" });
        }
    }

    function spawn() {
        if(wave % 10 === 0) boss = { x: 400, y: -50, hp: 1200*wave, max: 1200*wave, s: 0.8, r: 60 };
        else for(let i=0; i<wave*5+5; i++) enemies.push({ x: Math.random()*800, y: Math.random()>0.5?-20:620, hp: 20+wave*5, s: 1.1+wave*0.04, r: 15 });
    }

    function fire(plr, angle) {
        let w = plr.inv[plr.cur];
        let rate = (w==='ALEV MAKINESI'?60 : w==='POMPALI'?800:400);
        if(Date.now() - plr.lastS < rate) return;
        if(w==='POMPALI') for(let i=-2; i<=2; i++) bullets.push({ x: plr.x, y: plr.y, vx: Math.cos(angle+i*0.2)*9, vy: Math.sin(angle+i*0.2)*9, t: chars[Math.floor(Math.random()*chars.length)], l: 40, u: false, c: plr.color });
        else if(w==='ALEV MAKINESI') bullets.push({ x: plr.x, y: plr.y, vx: Math.cos(angle+(Math.random()-0.5)*0.3)*8, vy: Math.sin(angle+(Math.random()-0.5)*0.3)*8, t: chars[Math.floor(Math.random()*chars.length)], l: 30, u: true, c: "orange" });
        else bullets.push({ x: plr.x, y: plr.y, vx: Math.cos(angle)*11, vy: Math.sin(angle)*11, t: chars[Math.floor(Math.random()*chars.length)], l: 60, u: false, c: plr.color });
        plr.lastS = Date.now();
        if(plr.ulti < 10) plr.ulti += 0.25;
    }

    function loop() {
        if(!run || paused) { requestAnimationFrame(loop); return; }
        if(slowMo > 0) slowMo--;
        let sm = slowMo > 0 ? 0.3 : 1;

        // P1 Hareket & Ate≈ü
        if(keys['KeyW'] && p1.y > 20) p1.y -= p1.s*sm; if(keys['KeyS'] && p1.y < 580) p1.y += p1.s*sm;
        if(keys['KeyA'] && p1.x > 20) p1.x -= p1.s*sm; if(keys['KeyD'] && p1.x < 780) p1.x += p1.s*sm;
        if(mPos.d) fire(p1, Math.atan2(mPos.y-p1.y, mPos.x-p1.x));

        // P2 Hareket & √ñzel Ate≈ü Kontrolleri
        if(isDuo && p2.hp > 0) {
            if(keys['ArrowUp'] && p2.y > 20) p2.y -= p2.s*sm; if(keys['ArrowDown'] && p2.y < 580) p2.y += p2.s*sm;
            if(keys['ArrowLeft'] && p2.x > 20) p2.x -= p2.s*sm; if(keys['ArrowRight'] && p2.x < 780) p2.x += p2.s*sm;
            
            if(keys['PageUp']) fire(p2, -Math.PI/2); // √úst
            if(keys['PageDown']) fire(p2, Math.PI/2); // Alt
            if(keys['Home']) fire(p2, Math.PI); // Sol
            if(keys['NumLock']) fire(p2, 0); // Saƒü
        }

        bullets.forEach((b, i) => { b.x += b.vx*sm; b.y += b.vy*sm; b.l--; if(b.l<0) bullets.splice(i, 1); });

        enemies.forEach((e, ei) => {
            // En yakƒ±n oyuncuyu hedefle
            let target = p1;
            if(isDuo && p2.hp > 0) {
                let d1 = Math.hypot(p1.x-e.x, p1.y-e.y);
                let d2 = Math.hypot(p2.x-e.x, p2.y-e.y);
                target = d1 < d2 ? p1 : p2;
            }
            let ang = Math.atan2(target.y-e.y, target.x-e.x);
            e.x += Math.cos(ang)*e.s*sm; e.y += Math.sin(ang)*e.s*sm;

            if(Math.hypot(p1.x-e.x, p1.y-e.y) < 25) p1.hp -= 0.3;
            if(isDuo && Math.hypot(p2.x-e.x, p2.y-e.y) < 25) p2.hp -= 0.3;

            bullets.forEach((b, bi) => {
                if(Math.hypot(e.x-b.x, e.y-b.y) < 20) { 
                    e.hp -= (b.u?100:30); 
                    if(!b.u) bullets.splice(bi, 1); 
                    if(e.hp<=0) { enemies.splice(ei, 1); (b.c==="#0f0"?p1:p2).money+=10; }
                }
            });
        });

        if(boss) {
            let ba = Math.atan2(p1.y-boss.y, p1.x-boss.x);
            boss.x += Math.cos(ba)*boss.s*sm; boss.y += Math.sin(ba)*boss.s*sm;
            if(Math.hypot(p1.x-boss.x, p1.y-boss.y) < boss.r) p1.hp -= 1;
            if(isDuo && Math.hypot(p2.x-boss.x, p2.y-boss.y) < boss.r) p2.hp -= 1;
            bullets.forEach((b, bi) => {
                if(Math.hypot(boss.x-b.x, boss.y-b.y) < boss.r) { boss.hp -= (b.u?15:25); if(!b.u) bullets.splice(bi, 1); if(boss.hp<=0) { boss=null; (b.c==="#0f0"?p1:p2).money+=500; wave++; spawn(); }}
            });
        }

        if(enemies.length === 0 && !boss) { wave++; spawn(); }
        if(p1.hp <= 0 && (!isDuo || p2.hp <= 0)) location.reload();

        // Aray√ºz G√ºncelleme
        document.getElementById('h1').innerText = Math.max(0, Math.floor(p1.hp));
        document.getElementById('m1').innerText = p1.money;
        document.getElementById('u1').style.width = (p1.ulti*10) + "%";
        if(isDuo) {
            document.getElementById('h2').innerText = Math.max(0, Math.floor(p2.hp));
            document.getElementById('m2').innerText = p2.money;
            document.getElementById('u2').style.width = (p2.ulti*10) + "%";
        }
        document.getElementById('w').innerText = wave;

        ctx.clearRect(0,0,800,600);
        if(slowMo > 0) { ctx.fillStyle = "rgba(0,255,255,0.15)"; ctx.fillRect(0,0,800,600); }
        ctx.fillStyle = p1.color; ctx.font = "24px monospace"; ctx.fillText(p1.sym, p1.x-10, p1.y+10);
        if(isDuo && p2.hp > 0) { ctx.fillStyle = p2.color; ctx.fillText(p2.sym, p2.x-10, p2.y+10); }
        bullets.forEach(b => { ctx.fillStyle = b.c; ctx.font = "16px monospace"; ctx.fillText(b.t, b.x, b.y); });
        enemies.forEach(e => { ctx.fillStyle = "red"; ctx.font = "20px monospace"; ctx.fillText("X", e.x-10, e.y+10); });
        if(boss) { ctx.fillStyle = "magenta"; ctx.font = "bold 80px sans-serif"; ctx.fillText("G", boss.x-30, boss.y+30); }
        requestAnimationFrame(loop);
    }
</script>
</body>
</html>