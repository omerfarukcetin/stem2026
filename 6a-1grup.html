<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Kelime Bah√ßesi: Final G√ºvenlik Modu üå∏</title>
    <style>
        /* --- 1. GENEL AYARLAR & ARKA PLAN --- */
        body { 
            margin: 0; overflow: hidden; 
            font-family: 'Arial', sans-serif; user-select: none;
            touch-action: none;
            transition: background 0.5s;
        }

        /* VARSAYILAN: MASUM MOD (PEMBE) */
        body.innocent {
            background: linear-gradient(180deg, #ffe6f2 0%, #fff0f5 100%);
            color: #d63384;
        }
        /* Arka plan s√ºsleri (Sabit) */
        body.innocent::before {
            content: "üå∏ ü¶ã üå∑ üêû üåº üêù üåª";
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            font-size: 50px; opacity: 0.1; z-index: -1;
            display: flex; flex-wrap: wrap; justify-content: space-around; align-content: center;
            pointer-events: none;
        }

        /* HACKER MODU (Hata Yapƒ±nca) */
        body.hacker {
            background: #000 !important;
            color: #0f0 !important;
        }
        body.hacker::before { display: none; } /* S√ºsleri gizle */
        body.hacker canvas { filter: drop-shadow(0 0 5px lime); }
        
        /* --- 2. OYUN SAHASI --- */
        canvas { 
            display: block; position: absolute; top: 0; left: 0; z-index: 1; 
        }

        /* UI KATMANI (Puan, S√ºre vb.) */
        #game-ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none; display: none; /* Ba≈üta gizli */
        }
        .hud-top {
            display: flex; justify-content: space-between; padding: 15px;
            font-size: 20px; font-weight: bold;
        }
        #collected-word {
            position: absolute; bottom: 50px; width: 100%; text-align: center;
            font-size: 40px; font-family: monospace; font-weight: bold; letter-spacing: 5px;
        }

        /* --- 3. MEN√úLER VE MODALLAR --- */
        
        /* Gƒ∞Rƒ∞≈û EKRANI */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,240,245, 0.9); z-index: 50;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .big-btn {
            background: #ff1493; color: white; border: none; padding: 20px 50px;
            font-size: 22px; border-radius: 50px; cursor: pointer; margin-top: 20px;
            box-shadow: 0 10px 20px rgba(255,20,147,0.3);
            transition: transform 0.2s;
        }
        .big-btn:active { transform: scale(0.95); }

        /* TARAMA MODALI (KAMERA BURADA) */
        #scan-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); z-index: 100;
            display: none; /* JS ile a√ßƒ±lacak */
            flex-direction: column; align-items: center; justify-content: center;
        }
        .camera-box {
            position: relative; width: 300px; height: 300px;
            border: 4px solid #00ff00; border-radius: 20px; overflow: hidden;
            box-shadow: 0 0 30px #00ff00; background: #000;
        }
        #webcam {
            width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1);
        }
        .scan-laser {
            position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: #00ff00; box-shadow: 0 0 10px #00ff00;
            animation: scanning 1.5s infinite ease-in-out;
        }
        @keyframes scanning { 0% {top:0;} 50% {top:100%;} 100% {top:0;} }
        #scan-text {
            color: #00ff00; font-family: monospace; font-size: 18px; margin-top: 20px;
            text-align: center;
        }

        /* SONU√á EKRANLARI */
        #win-screen, #lose-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 200; align-items: center; justify-content: center; flex-direction: column;
        }
        #win-screen { background: rgba(255, 215, 0, 0.95); color: #d35400; }
        #lose-screen { background: black; color: red; }
        .result-box {
            background: white; padding: 40px; border-radius: 20px; text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

    </style>
</head>
<body class="innocent">

    <div id="start-screen">
        <h1 style="color:#ff69b4; font-size:40px; text-shadow: 2px 2px white;">üå∏ KELƒ∞ME BAH√áESƒ∞ üå∏</h1>
        <p style="color:#555;">Harfleri topla, seviyeleri ge√ß!</p>
        <button class="big-btn" id="btn-start">OYUNA BA≈ûLA</button>
    </div>

    <div id="scan-modal">
        <div class="camera-box">
            <video id="webcam" autoplay playsinline muted></video>
            <div class="scan-laser"></div>
        </div>
        <div id="scan-text">Y√úZ TARANIYOR...</div>
    </div>

    <div id="game-ui">
        <div class="hud-top">
            <span>HEDEF: <span id="lbl-target" style="color:red"></span></span>
            <span>S√úRE: <span id="lbl-timer"></span></span>
        </div>
        <div style="position:absolute; top:50px; left:15px; font-weight:bold;">SEVƒ∞YE: <span id="lbl-level">1</span></div>
        <div id="collected-word"></div>
    </div>
    
    <canvas id="canvas"></canvas>

    <div id="win-screen">
        <div class="result-box">
            <div style="font-size:60px;">üèÜ</div>
            <h1>TEBRƒ∞KLER!</h1>
            <button class="big-btn" style="background:#28a745;" onclick="nextLevel()">SONRAKƒ∞ SEVƒ∞YE ‚û°</button>
        </div>
    </div>

    <div id="lose-screen">
        <div style="font-size:100px;">üíÄ</div>
        <h1 style="font-family:Courier;">Sƒ∞STEM Kƒ∞Lƒ∞TLENDƒ∞</h1>
        <button class="big-btn" style="background:transparent; border:2px solid red; color:red;" onclick="location.reload()">TEKRAR DENE</button>
    </div>

    <audio id="s-click" src="https://actions.google.com/sounds/v1/ui/click_on.ogg"></audio>
    <audio id="s-win" src="https://actions.google.com/sounds/v1/cartoon/clown_horn.ogg"></audio>
    <audio id="s-lose" src="https://actions.google.com/sounds/v1/horror/female_scream_loud.ogg"></audio>
    <audio id="s-error" src="https://actions.google.com/sounds/v1/alarms/bugle_tune.ogg"></audio>

    <script>
        // --- AYARLAR VE DEƒûƒ∞≈ûKENLER ---
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const videoEl = document.getElementById('webcam');
        
        let width, height;
        let isRunning = false;
        let level = 1;
        let drops = [];
        let target = "";
        let collected = "";
        let timer = 0;
        let timerInt;
        let fails = 0;
        let streamRef = null; // Kamerayƒ± kapatmak i√ßin referans

        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

        // --- 1. BA≈ûLATMA VE KAMERA S√úRECƒ∞ ---
        document.getElementById('btn-start').addEventListener('click', async () => {
            playSound('s-click');
            
            // Giri≈ü ekranƒ±nƒ± gizle
            document.getElementById('start-screen').style.display = 'none';
            
            // Tarama ekranƒ±nƒ± a√ß
            document.getElementById('scan-modal').style.display = 'flex';

            // Kamerayƒ± a√ßmayƒ± dene
            try {
                streamRef = await navigator.mediaDevices.getUserMedia({ video: true });
                videoEl.srcObject = streamRef;
                
                // Sahte Tarama Animasyonu (3 saniye)
                let percent = 0;
                const scanInterval = setInterval(() => {
                    percent += 2;
                    document.getElementById('scan-text').innerText = `Y√úZ TARANIYOR... %${percent}`;
                    if(percent >= 100) {
                        clearInterval(scanInterval);
                        finishScanning(); // Taramayƒ± bitir
                    }
                }, 40);

            } catch (err) {
                // Kamera yoksa veya izin verilmezse direkt oyuna ge√ß
                alert("Kamera bulunamadƒ±, manuel giri≈ü yapƒ±lƒ±yor...");
                finishScanning();
            }
        });

        function finishScanning() {
            // 1. Kamerayƒ± durdur ve kapat
            if(streamRef) {
                streamRef.getTracks().forEach(track => track.stop());
                videoEl.srcObject = null;
            }

            // 2. Tarama ekranƒ±nƒ± gizle
            document.getElementById('scan-modal').style.display = 'none';

            // 3. Oyun aray√ºz√ºn√º a√ß
            document.getElementById('game-ui').style.display = 'block';

            // 4. Oyunu ba≈ülat
            initGame();
        }

        // --- 2. OYUN MEKANƒ∞ƒûƒ∞ ---
        function initGame() {
            // Ekran Boyutu
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;

            // Deƒüi≈ükenleri Sƒ±fƒ±rla
            document.body.className = "innocent"; // Temayƒ± Pembe Yap
            fails = 0;
            drops = [];
            collected = "";
            isRunning = true;
            document.getElementById('win-screen').style.display = 'none';

            // Seviye Zorluƒüu
            let len = 4 + level; if(len > 10) len = 10;
            let timeMax = 60 - (level * 3); if(timeMax < 20) timeMax = 20;

            // Hedef Kelime
            target = "";
            for(let i=0; i<len; i++) target += chars[Math.floor(Math.random() * chars.length)];
            
            // UI G√ºncelle
            document.getElementById('lbl-target').innerText = target;
            document.getElementById('lbl-level').innerText = level;
            timer = timeMax;
            updateWordUI();

            // Saya√ß Ba≈ülat
            if(timerInt) clearInterval(timerInt);
            timerInt = setInterval(() => {
                if(!isRunning) return;
                timer--;
                document.getElementById('lbl-timer').innerText = timer;
                
                if(timer <= 10) document.body.className = "hacker"; // Son 10sn gerilim
                if(timer <= 0) gameOver();
            }, 1000);

            // Animasyon D√∂ng√ºs√º
            gameLoop();
        }

        function gameLoop() {
            if(!isRunning) return;
            ctx.clearRect(0,0,width,height);

            // Harf D√º≈ü√ºrme
            if(Math.random() < 0.04) { // D√º≈üme sƒ±klƒ±ƒüƒ±
                let charVal;
                let needed = target[collected.length];
                
                // Yardƒ±m ≈üansƒ± (Seviye arttƒ±k√ßa azalƒ±r)
                let help = 0.5 - (level * 0.05); if(help < 0.1) help = 0.1;

                if(Math.random() < help && needed) charVal = needed;
                else charVal = chars[Math.floor(Math.random() * chars.length)];

                drops.push({
                    x: Math.random() * (width - 50) + 25,
                    y: -50,
                    val: charVal,
                    speed: 3 + (level * 0.5) + Math.random() * 2
                });
            }

            // √áizim ve Hareket
            drops.forEach((d, i) => {
                d.y += d.speed;
                
                // Tema Rengi
                ctx.fillStyle = document.body.classList.contains('hacker') ? "#0f0" : "#ff1493";
                ctx.font = "bold 45px Courier New";
                ctx.fillText(d.val, d.x, d.y);

                // Ekrandan √ßƒ±karsa sil
                if(d.y > height) drops.splice(i, 1);
            });

            requestAnimationFrame(gameLoop);
        }

        // --- 3. KONTROLLER ---
        function handleInput(x, y) {
            if(!isRunning) return;

            for(let i=0; i<drops.length; i++) {
                let d = drops[i];
                // Tƒ±klama mesafesi
                if(Math.hypot(d.x - x, d.y - y) < 80) {
                    let needed = target[collected.length];

                    if(d.val === needed) {
                        // DOƒûRU
                        playSound('s-click');
                        collected += d.val;
                        drops.splice(i, 1);
                        updateWordUI();

                        if(collected === target) winGame();
                    } else {
                        // YANLI≈û
                        playSound('s-error');
                        fails++;
                        document.body.className = "hacker"; // Hata yapƒ±nca kararƒ±r
                        drops.splice(i, 1);
                        if(fails >= 3) gameOver();
                    }
                    return;
                }
            }
        }

        canvas.addEventListener('mousedown', e => handleInput(e.clientX, e.clientY));
        canvas.addEventListener('touchstart', e => {
            e.preventDefault();
            handleInput(e.touches[0].clientX, e.touches[0].clientY);
        }, {passive:false});

        // --- 4. YARDIMCILAR ---
        function updateWordUI() {
            let txt = "";
            for(let i=0; i<target.length; i++) {
                txt += (i < collected.length ? collected[i] : "_") + " ";
            }
            document.getElementById('collected-word').innerText = txt;
        }

        function winGame() {
            isRunning = false;
            clearInterval(timerInt);
            playSound('s-win');
            document.getElementById('win-screen').style.display = 'flex';
        }

        function gameOver() {
            isRunning = false;
            clearInterval(timerInt);
            playSound('s-lose');
            document.getElementById('game-ui').style.display = 'none';
            document.getElementById('lose-screen').style.display = 'flex';
        }

        function nextLevel() {
            level++;
            initGame();
        }

        function playSound(id) {
            const s = document.getElementById(id);
            if(s) { s.currentTime=0; s.play().catch(()=>{}); }
        }

        window.onresize = () => { width=window.innerWidth; height=window.innerHeight; canvas.width=width; canvas.height=height; };

    </script>
</body>
</html>