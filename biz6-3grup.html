<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>CipherQuest: GeliÅŸmiÅŸ Market ve Ã‡ifte KoÅŸu</title>
    <style>
        :root { --mavi: #AEC6CF; --pembe: #ff9ff3; --altin: #FAD02E; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #1a1a2e; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        
        .panel { background: rgba(255, 255, 255, 0.95); border-radius: 25px; padding: 25px; width: 500px; text-align: center; box-shadow: 0 15px 40px rgba(0,0,0,0.5); z-index: 20; position: absolute; }
        .hidden { display: none; }
        
        #game-canvas { background: linear-gradient(#1a1a2e, #16213e); display: none; border: 5px solid #3498db; border-radius: 20px; }
        
        .btn { background: #3498DB; color: white; border: none; padding: 10px 18px; cursor: pointer; font-weight: bold; border-radius: 10px; margin: 5px; transition: 0.3s; font-size: 13px; }
        .btn:hover { transform: scale(1.05); background: #2980B9; }
        
        #cam-box { position: absolute; top: 20px; right: 20px; width: 130px; height: 90px; border: 3px solid white; border-radius: 12px; overflow: hidden; background: #000; z-index: 50; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        
        .stats { position: absolute; top: 20px; left: 20px; color: white; font-family: monospace; font-size: 18px; z-index: 100; background: rgba(0,0,0,0.7); padding: 12px; border-radius: 10px; border: 1px solid #3498db; }
        
        .market-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-height: 250px; overflow-y: auto; padding: 10px; border: 1px solid #eee; border-radius: 10px; }
        .market-item { background: #f8f9fa; padding: 8px; border-radius: 8px; border: 1px solid #ddd; }
        .market-section-title { margin: 10px 0 5px 0; display: block; color: #2c3e50; font-weight: bold; font-size: 14px; text-transform: uppercase; }
    </style>
</head>
<body>

    <div class="stats hidden" id="game-ui">
        â±ï¸ SÃœRE: <span id="timer-display">30</span>s<br>
        ğŸ’° COIN: <span id="coin-val">0</span><br>
        ğŸ” ÅÄ°FRE: <span id="pass-val"></span>
    </div>

    <div class="panel" id="screen-permission">
        <h1>ğŸ” CipherQuest</h1>
        <p>Kamera izni vererek biyometrik giriÅŸi tamamla.</p>
        <button class="btn" onclick="requestCamera()">KAMERAYI AÃ‡</button>
    </div>

    <div class="panel hidden" id="screen-user">
        <h2>Kimlik OnaylandÄ±</h2>
        <input type="text" id="username" placeholder="KullanÄ±cÄ± AdÄ±...">
        <button class="btn" onclick="toHub()">SÄ°STEME GÄ°R</button>
    </div>

    <div class="panel hidden" id="screen-hub">
        <h2 id="welcome-msg">HoÅŸ Geldin</h2>
        <button class="btn" style="background:#2ecc71; width:80%;" onclick="startRunner()">ğŸƒ KLASÄ°K KOÅU (EJDERHA)</button><br>
        <button class="btn" style="background:#e84393; width:80%;" onclick="startSanrioRunner()">ğŸ„ SANRIO & SPRUNKI KOÅUSU</button><br>
        <button class="btn" style="background:#f1c40f; width:80%;" onclick="showShop()">ğŸ›’ MARKETÄ° AÃ‡</button>
    </div>

    <div class="panel hidden" id="screen-shop">
        <h3>SÄ°BER MARKET</h3>
        <p>CÃ¼zdan: <span id="shop-coins">0</span> ğŸ’°</p>
        <div class="market-grid">
            <span class="market-section-title">ğŸ‰ Ejderhalar</span>
            <div class="market-item">â„ï¸ Buz (100) <button class="btn" onclick="buy('â„ï¸', 100)">AL</button></div>
            <div class="market-item">ğŸ”¥ Kar (200) <button class="btn" onclick="buy('ğŸ”¥', 200)">AL</button></div>
            
            <span class="market-section-title">ğŸ€ Sanrio</span>
            <div class="market-item">ğŸ€ Kitty (150) <button class="btn" onclick="buy('ğŸ€', 150)">AL</button></div>
            <div class="market-item">ğŸ° Melody (150) <button class="btn" onclick="buy('ğŸ°', 150)">AL</button></div>
            <div class="market-item">ğŸ¸ Keroppi (150) <button class="btn" onclick="buy('ğŸ¸', 150)">AL</button></div>
            
            <span class="market-section-title">ğŸ‘¾ Sprunki</span>
            <div class="market-item">ğŸ‘¾ Tune (200) <button class="btn" onclick="buy('ğŸ‘¾', 200)">AL</button></div>
            <div class="market-item">ğŸ¤– Robot (200) <button class="btn" onclick="buy('ğŸ¤–', 200)">AL</button></div>
            <div class="market-item">ğŸ‘» Ghost (200) <button class="btn" onclick="buy('ğŸ‘»', 200)">AL</button></div>
        </div>
        <button class="btn" style="background:#95a5a6; margin-top:15px;" onclick="toHub()">MENÃœYE DÃ–N</button>
    </div>

    <div class="panel hidden" id="screen-result">
        <h2 style="color:#e74c3c">TUR TAMAMLANDI</h2>
        <p id="result-text"></p>
        <button class="btn" style="background:#2ecc71" onclick="startRunner()">KLASÄ°K</button>
        <button class="btn" style="background:#e84393" onclick="startSanrioRunner()">SANRIO</button>
        <button class="btn" style="background:#95a5a6" onclick="toHub()">MENÃœ</button>
    </div>

    <div id="cam-box" class="hidden"><video id="webcam" autoplay playsinline></video></div>
    <canvas id="game-canvas" width="800" height="400"></canvas>
    <button id="pause-btn" class="btn hidden" style="position:absolute; bottom:20px; right:20px; background:#e67e22;" onclick="togglePause()">DURAKLAT (P)</button>

    <script>
        let coins = 0;
        let activeDragon = 'ğŸ¦';
        let activeSanrio = 'ğŸ€';
        let inventory = ['ğŸ¦', 'ğŸ€'];
        let collectedPass = "";
        let isPaused = false, gameActive = false, timeLeft = 30, timerInterval, isSanrioMode = false;

        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        let player = { x: 150, y: 300, w: 50, h: 50, dy: 0, jump: -15, ground: 300, gravity: 0.8 };
        let obstacles = [], boss = { char: 'ğŸ²', x: -100 }, frame = 0;

        function requestCamera() {
            navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
                document.getElementById('webcam').srcObject = stream;
                document.getElementById('cam-box').classList.remove('hidden');
                switchScreen('screen-user');
            }).catch(() => alert("Kamera izni reddedildi!"));
        }

        function toHub() {
            const name = document.getElementById('username').value || "Ajan";
            document.getElementById('welcome-msg').innerText = "HoÅŸ Geldin, " + name;
            switchScreen('screen-hub');
        }

        function showShop() {
            document.getElementById('shop-coins').innerText = coins;
            switchScreen('screen-shop');
        }

        function buy(skin, cost) {
            if(coins >= cost && !inventory.includes(skin)) {
                coins -= cost; inventory.push(skin);
                updateSkinSelection(skin);
                document.getElementById('shop-coins').innerText = coins;
                alert(skin + " AlÄ±ndÄ±!");
            } else if(inventory.includes(skin)) {
                updateSkinSelection(skin);
                alert(skin + " SeÃ§ildi!");
            } else { alert("Yetersiz Coin!"); }
        }

        function updateSkinSelection(skin) {
            // EÄŸer sanrio veya sprunki ise
            if(['ğŸ€','ğŸ°','ğŸ¸','ğŸ®','ğŸ‘¾','ğŸ¤–','ğŸ‘»'].includes(skin)) activeSanrio = skin;
            else activeDragon = skin;
        }

        function switchScreen(id) {
            document.querySelectorAll('.panel').forEach(p => p.classList.add('hidden'));
            if(id) document.getElementById(id).classList.remove('hidden');
            else canvas.style.display = 'none';
        }

        // --- OYUN MANTIÄI ---
        function startRunner() { 
            isSanrioMode = false; 
            initGame(); 
            requestAnimationFrame(gameLoop); 
        }
        function startSanrioRunner() { 
            isSanrioMode = true; 
            initGame(); 
            requestAnimationFrame(gameLoop); 
        }

        function initGame() {
            switchScreen(null);
            canvas.style.display = 'block';
            document.getElementById('pause-btn').classList.remove('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            gameActive = true; isPaused = false; collectedPass = ""; obstacles = []; frame = 0;
            timeLeft = 30;
            updateUI();
            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if(!isPaused && gameActive) {
                    timeLeft--;
                    document.getElementById('timer-display').innerText = timeLeft;
                    if(timeLeft <= 0) endGame();
                }
            }, 1000);
        }

        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            document.getElementById('result-text').innerHTML = `Coin: ${coins} ğŸ’°<br>Åifre: ${collectedPass || '-'}`;
            switchScreen('screen-result');
        }

        function gameLoop() {
            if(!gameActive || isPaused) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            frame++;

            // Zemin ve Karakter Ã‡izimi
            ctx.fillStyle = isSanrioMode ? "#e84393" : "#2c3e50";
            ctx.fillRect(0, 350, canvas.width, 50);

            player.dy += player.gravity; player.y += player.dy;
            if(player.y > player.ground) { player.y = player.ground; player.dy = 0; }
            
            ctx.font = "50px serif";
            ctx.fillText(isSanrioMode ? activeSanrio : activeDragon, player.x, player.y + 45);
            ctx.font = "100px serif";
            ctx.fillText(boss.char, boss.x + (Math.sin(frame/10)*15), 330);

            // Obje OluÅŸturma (Her iki modda da sadece Coin ve Åifre)
            if(frame % 60 === 0) {
                const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!#@";
                const isCoin = Math.random() < 0.3;
                obstacles.push({
                    x: canvas.width,
                    y: Math.random() > 0.5 ? 310 : 230,
                    type: isCoin ? 'coin' : 'char',
                    val: isCoin ? 'ğŸ’°' : chars[Math.floor(Math.random()*chars.length)]
                });
            }

            // Obje GÃ¼ncelleme
            obstacles.forEach((obj, i) => {
                obj.x -= 7;
                ctx.font = "30px Arial";
                ctx.fillStyle = obj.type === 'coin' ? "#f1c40f" : "#fff";
                ctx.fillText(obj.val, obj.x, obj.y);

                if(player.x < obj.x + 30 && player.x + 50 > obj.x && player.y < obj.y && player.y + 50 > obj.y - 30) {
                    if(obj.type === 'coin') coins += 10;
                    else collectedPass += obj.val;
                    obstacles.splice(i, 1);
                    updateUI();
                }
            });

            if(obstacles.length > 20) obstacles.shift();
            requestAnimationFrame(gameLoop);
        }

        function togglePause() {
            isPaused = !isPaused;
            if(!isPaused) requestAnimationFrame(gameLoop);
            document.getElementById('pause-btn').innerText = isPaused ? "DEVAM" : "DURAKLAT";
        }

        function updateUI() {
            document.getElementById('coin-val').innerText = coins;
            document.getElementById('pass-val').innerText = collectedPass;
        }

        window.addEventListener('keydown', (e) => { 
            if(e.code === 'Space' && player.y === player.ground) player.dy = player.jump; 
            if(e.code === 'KeyP') togglePause();
        });
        canvas.addEventListener('mousedown', () => { if(player.y === player.ground) player.dy = player.jump; });
    </script>
</body>
</html>